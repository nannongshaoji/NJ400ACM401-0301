#ifndef __LS1B_SPI_H
#define __LS1B_SPI_H


// SPI模块编号
typedef enum
{
    LS1B_SPI_0 = 0,
    LS1B_SPI_1,
}ls1b_spi_t;


// 片选
#define LS1B_SPI_INVALID_CS             (-1)    //
#define LS1B_SPI_CS_0                   (0)     //GPIO27
#define LS1B_SPI_CS_1                   (1)     //GPIO28
#define LS1B_SPI_CS_2                   (2)     //GPIO29
#define LS1B_SPI_CS_3                   (3)     //GPIO30

// 时钟极性和相位
#define SPI_CPOL_1                      (1)
#define SPI_CPOL_0                      (0)
#define SPI_CPHA_1                      (1)
#define SPI_CPHA_0                      (0)


// 硬件SPI信息
typedef struct
{
    ls1b_spi_t SPIx;                    // SPI模块编号
    unsigned long max_speed_hz;         // 最大通信速度，单位hz
    unsigned char cs;                   // 片选
    unsigned char cpol;                 // 时钟极性
    unsigned char cpha;                 // 时钟相位
}ls1b_spi_info_t;



/*
 * 初始化指定SPI模块
 * @spi_info_p SPI模块信息
 */
void spi_init(ls1b_spi_info_t *spi_info_p);


/*
 * 设置指定片选为指定状态
 * @spi_info_p SPI模块信息
 * @new_status 片选引脚的新状态，取值为0或1，即高电平或低电平
 */
void spi_set_cs(ls1b_spi_info_t *spi_info_p, int new_status);


/*
 * 通过指定SPI发送接收一个字节
 * 注意，在多任务的系统中，此函数需要互斥。
 * 即保证在和某个从设备收发某个字节的过程中，不能被切换到其它任务同时与另外的在同一个SPI总线上的从设备通信
 * 因为龙芯1c的每路SPI上可能接有不同的从设备，通信频率、模式等可能不同
 * @spi_info_p SPI接口
 * @tx_ch 待发送的数据
 * @ret 收到的数据
 */
unsigned char spi_txrx_byte(ls1b_spi_info_t *spi_info_p, unsigned char tx_ch);


/*
 * 打印指定SPI模块的所有寄存器的值
 * @spi_info_p SPI模块信息
 */
void spi_print_all_regs_info(ls1b_spi_info_t *spi_info_p);



inline int fls(int x);


#endif


